
# ТехноТест ВК

Тестовое задание для ВК.



## Автор

- [@pritexx](https://www.github.com/pritexx)


# Структура проекта

## VkTechTest

- *Contracts* - Классы контрактов для запросов/ответов
- *Controllers* - Контроллеры запросов приложения
- *Database* - Контекст бд и модели 
- *Mappers* - Мапперы моделей
- *Migrations* - Миграции приложения
- *Models* - Основные модели для приложения, включая классы ошибок
- *Repositories* - Классы для доступа к базе данных
- *Services* - Основные классы с бизнес логикой


## VkTechTest.Tests

- DatabaseTests.cs  - Вспомогательный класс, в котором создается, настраивается и управляется Docker контейнер с инстансом базы данных
- Services - Основные тесты бизнес логики

### Объяснение

Я выбрал подход тестирования с TestСontainers т.к. логика, которая тестируется должна проверяться на реальной базе данных, чтобы от таких тестов был смысл. Юнит-тесты должны проверять единицу поведения, а если бы я сделал мокап IUserRepository или использовал бы InMemoryDatabase provider для ef core, то такие тесты были бы не так сильно приближены к продуктовым условиям и следовательно не были бы такими точными.



 


## Уточнение задания

Я не совсем понял пункт: `Добавление нового пользователя должно занимать 5 сек. За это время при попытке добавления пользователя с таким же login должна возвращаться ошибка` 

А после прошествия 5 секунд можно спокойно добавлять несколько пользователей с одним и тем же логином? Как тогда быть с авторизацией, как понять, какой пользователь кто?

# Миграции

Я подправил авто-сненерированный код миграции, чтобы в начальной миграции в бд сразу добавлялись все нужные сущности(user_state: Active; user_group: Admin и т.д.) Также в миграции заодно и добавляется admin пользователь, так что в приложении нет никакой возможности добавить 2 Admin пользователя (кроме как руками лезть в бд). Такой подход был выбран, т.к. приложение не может работать без заранее установленных user_state и user_group в бд, также как и без root пользователя(Admin). Поэтому самое разумное место, куда встроить добавления этих сущностей это код миграции, т.к. без них приложение не будет работать так же как и без заранее созданных таблиц в бд.

